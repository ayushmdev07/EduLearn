@model IEnumerable<Education.Models.UserClass>
@{
    Layout = "_AdminSidebar";
    ViewData["Title"] = "Students";
}

@if (TempData["UpdateSuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>@TempData["UpdateSuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}

@if (TempData["StudentDeleteSuccessMessage"] != null)
{
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle me-2"></i>@TempData["StudentDeleteSuccessMessage"]
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
}




<h1 class="mb-4">Admin Dashboard / Students</h1>

<div class="row g-3">


    <div class="col-md-4">
        <a asp-action="Index" asp-controller="Admin" class="text-decoration-none">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title mb-1">Admin</h5>
                    <h2 class="display-4 mb-0 mt-4">@ViewBag.AdminCount</h2>
                    <p class="card-text mb-0"><i class="bi bi-people-fill me-2"></i>Manage Admin</p>
                </div>
            </div>
        </a>
    </div>



    <div class="col-md-4">
        <a asp-action="Students" asp-controller="Admin" class="text-decoration-none text-dark">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Student</h5>
                    <h2 class="display-4 mb-0 mt-4">@ViewBag.Totalstudents</h2>
                    <p class="card-text"><i class="bi bi-people-fill me-2"></i>Manage Student</p>
                </div>
            </div>
        </a>
    </div>


    <div class="col-md-4">
        <a asp-action="Course" asp-controller="Admin" class="text-decoration-none text-dark">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Courses</h5>
                    <h2 class="display-4 mt-4 mb-0">@ViewBag.TotalCourse</h2>
                    <p class="card-text"><i class="bi bi-people-fill me-2"></i>Manage Course</p>
                </div>
            </div>
        </a>
    </div>


</div>


<hr>

<!-- Graph Start -->

<div class="row g-3">


    <div class="col-md-12">



        <div class="container py-4 ">
            <div class="chart-section border">
                <h3 class="chart-title"><i class="bi bi-graph-up-arrow"></i> Student Analytics Dashboard
                </h3>

                <!-- Info Cards -->
                <div class="row g-4 mb-4">
                    <div class="col-md-4">
                        <div class="Gcard text-center p-3 border">
                            <h5 class="Gcard-title">Total Registered</h5>
                            <h2 id="totalStudents" class="text-primary fw-bold">@ViewBag.TotalStudents</h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="Gcard text-center p-3 border">
                            <h5 class="Gcard-title">Active Students</h5>
                            <h2 id="activeStudents" class="text-success fw-bold">@ViewBag.ActiveStudents</h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="Gcard text-center p-3 border">
                            <h5 class="Gcard-title">Inactive Students</h5>
                            <h2 id="inactiveStudents" class="text-danger fw-bold">@ViewBag.InactiveStudents</h2>
                        </div>
                    </div>
                </div>

                <!-- Chart -->
                <canvas id="studentChart" height="100"></canvas>
            </div>
        </div>


    </div>
</div>

<!-- Gardp End -->



<hr>





<div class="row g-3">
    @foreach (var userstudents in Model)
    {
        <div class="col-md-3">
            <div class="card">
                <div class="card-body text-center">
                    <h5 class="card-title mb-4">@userstudents.UserId</h5>
                    @if (!string.IsNullOrEmpty(userstudents.UserImage))
                    {
                        <img src="@Url.Action("ShowAdminImage", "Admin", new { FileName = userstudents.UserImage})"
                             class="rounded-circle"
                             style="width: 100px; height: 100px; object-fit: cover;"
                             alt="@userstudents.UserName">
                    }
                    else
                    {
                        <img src="~/Assets/StudentImage/image.png"
                             class="rounded-circle"
                             style="width: 100px; height: 100px; object-fit: cover;"
                             alt="Default">
                    }                      <p class="card-text mt-2 mb-0">@userstudents.UserFullName (@userstudents.UserName)</p>
                    <p class="card-text mt-0 mb-0">@userstudents.UserEmail</p>
                    <p class="card-text mt-0 mb-5">@userstudents.UserDOB</p>
                    <button type="button" class="btn btn-primary"
                            data-bs-toggle="modal"
                            data-bs-target="#updateModal_@userstudents.UserId">
                        Update
                    </button>
                    <button type="button" class="btn btn-danger"
                            data-bs-toggle="modal"
                            data-bs-target="#deleteModal_@userstudents.UserId">
                        Delete
                    </button>

                </div>
            </div>

        </div>



        <div class="modal fade" id="updateModal_@userstudents.UserId" tabindex="-1" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title">Update User</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                    </div>
                    <form asp-action="Updatestudent" asp-controller="Admin" method="post" enctype="multipart/form-data">
                        <div class="modal-body">
                            <input type="hidden" name="UserId" value="@userstudents.UserId" />

                            <div class="mb-3">
                                <label class="form-label">Username</label>
                                <input type="text" class="form-control" name="UserName" value="@userstudents.UserName" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-control" name="UserFullName" value="@userstudents.UserFullName" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Email</label>
                                <input type="email" class="form-control" name="UserEmail" value="@userstudents.UserEmail" required>
                            </div>

                            <div class="mb-3">
                                <label class="form-label">Date of Birth</label>
                                <input type="date" class="form-control" name="UserDOB" value="@userstudents.UserDOB" required>
                            </div>

                             <div class="mb-3"> 
                              <label class="form-label">User Image</label>
                                <input type="file" class="form-control" name="UserImage" value="@userstudents.UserImage">
                            </div>

                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                            <button type="submit" class="btn btn-primary">Save Changes</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>


            <div class="modal fade" id="deleteModal_@userstudents.UserId" tabindex="-1" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-danger text-white">
                            <h5 class="modal-title">Confirm Delete</h5>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                        </div>
                        <form asp-action="DeleteStudent" asp-controller="Admin" method="post">
                            <div class="modal-body">
                                <input type="hidden" name="StudentId" value="@userstudents.UserId" />
                                <p>Are you sure you want to delete <strong>@userstudents.UserName</strong>?</p>
                                <p class="text-danger">This action cannot be undone!</p>
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                                <button type="submit" class="btn btn-danger">Delete</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>

    }


            </div>


    <!-- Graph Script -->
    <script>
        const ctx = document.getElementById('studentChart').getContext('2d');

        const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
        const RegisteredStudentForGraph = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.RegisteredStudentForGraph))
        const ActiveStudentForGraph = @Html.Raw(System.Text.Json.JsonSerializer.Serialize(ViewBag.ActiveStudentForGraph))



        // Gradient lines
        const gradientBlue = ctx.createLinearGradient(0, 0, 600, 0);
        gradientBlue.addColorStop(0, '#6a11cb');
        gradientBlue.addColorStop(1, '#2575fc');

        const gradientGreen = ctx.createLinearGradient(0, 0, 600, 0);
        gradientGreen.addColorStop(0, '#38ef7d');
        gradientGreen.addColorStop(1, '#11998e');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: months,
                datasets: [
                    {
                        label: 'Total Registered',
                    data: RegisteredStudentForGraph,
                        borderColor: gradientBlue,
                        backgroundColor: 'rgba(37,117,252,0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#2575fc'
                    },
                    {
                        label: 'Active Students',
                    data: ActiveStudentForGraph,
                        borderColor: gradientGreen,
                        backgroundColor: 'rgba(56,239,125,0.1)',
                        fill: true,
                        tension: 0.4,
                        borderWidth: 3,
                        pointRadius: 4,
                        pointHoverRadius: 6,
                        pointBackgroundColor: '#11998e'
                    }
                ]
            },
            options: {
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: { color: '#495057', font: { size: 13 } }
                    },
                    tooltip: {
                        backgroundColor: '#343a40',
                        titleFont: { size: 13 },
                        bodyFont: { size: 12 },
                        cornerRadius: 10
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        grid: { color: 'rgba(0,0,0,0.05)' },
                        title: { display: true, text: 'Students Count', color: '#495057' }
                    },
                    x: {
                        grid: { display: false },
                        title: { display: true, text: 'Month', color: '#495057' }
                    }
                }
            }
        });
    </script>


    <!-- Sidebar Script -->

    <script>
        const sidebar = document.getElementById('sidebarMenu');
        const toggleSidebar = document.getElementById('toggleSidebar');
        const closeSidebar = document.getElementById('closeSidebar');
        const overlay = document.getElementById('overlay');

        // Function to set sidebar state based on screen width
        function setSidebarState() {
            if (window.innerWidth >= 768) {
                sidebar.classList.remove('collapsed'); // show sidebar on desktop
                overlay.classList.remove('show'); // hide overlay
            } else {
                sidebar.classList.add('collapsed'); // collapse sidebar on mobile
                overlay.classList.remove('show'); // hide overlay initially
            }
        }

        // Initial check on page load
        setSidebarState();

        // Toggle sidebar and overlay on mobile
        toggleSidebar.addEventListener('click', () => {
            sidebar.classList.toggle('collapsed');
            overlay.classList.toggle('show');
        });

        // Close sidebar via button or overlay
        closeSidebar.addEventListener('click', () => {
            sidebar.classList.add('collapsed');
            overlay.classList.remove('show');
        });
        overlay.addEventListener('click', () => {
            sidebar.classList.add('collapsed');
            overlay.classList.remove('show');
        });

        // Update sidebar state on resize
        window.addEventListener('resize', setSidebarState);

    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


        